## **7. T-Test & Mann-Whitney U-Test**

### Overview
- **Purpose**: Compare means/distributions between two independent or paired groups
- **Use Case**: Treatment vs control, before vs after measurements
- **Prerequisites**: Independent observations, continuous or ordinal data

### When to Use
#### Decision Criteria
- **Use T-Test when**: Data is normally distributed (Shapiro-Wilk p > 0.05)
- **Use Mann-Whitney when**: Data is not normally distributed or ordinal
- **Use Paired versions when**: Same subjects measured twice
- **Don't use when**: More than two groups (use ANOVA instead)
- **Data Types**: **T-Test: Continuous numeric**, **Mann-Whitney: Ordinal + Continuous**

### Data Type Requirements

#### T-Test:
- **Continuous Data**: Float, Double (required)
- **Normal Distribution**: Required assumption
- **Interval/Ratio Scale**: Equal intervals
- **Independent Observations**: No correlation between groups

#### Mann-Whitney U-Test:
- **Ordinal Data**: Ranked, ordered data
- **Continuous Data**: Any continuous numeric (distribution-free)
- **Skewed Data**: Handles non-normal distributions
- **Ties Handled**: Can manage tied ranks

**Not Suitable For**: Nominal categorical data, binary outcomes (use Chi-square instead)

### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `base R` | `scipy.stats` |
| T-Test Function | `t.test(group1, group2, paired=FALSE)` | `ttest_ind(group1, group2)` |
| U-Test Function | `wilcox.test(group1, group2)` | `mannwhitneyu(group1, group2)` |
| Normality Test | `shapiro.test(data)` | `shapiro(data)` |
| P-adjustment | `p.adjust(p, method="BH")` | `multipletests(p, method='fdr_bh')` |

### Quick Start Code

**R Example:**
```r
# T-test for two groups (base R)
t.test(as.numeric(matrix[i, group_start[[1]]:group_end[[1]]]),
       as.numeric(matrix[i, group_start[[2]]:group_end[[2]]]),
       alternative = "two.sided", paired = FALSE, conf.level = 0.95)

# Mann-Whitney U-test
wilcox.test(as.numeric(matrix[i, group_start[[1]]:group_end[[1]]]),
            as.numeric(matrix[i, group_start[[2]]:group_end[[2]]]),
            alternative = "two.sided", paired = FALSE)

# Multiple testing correction
p.adjust(p_values, method = "BH")
```

**Python Example:**
```python
from scipy import stats
from statsmodels.stats.multitest import multipletests

# Define groups (example: first 5 vs next 5 samples)
group1 = df.iloc[:5, 0]  # First feature, first 5 samples
group2 = df.iloc[5:10, 0]  # First feature, next 5 samples

# Test normality
_, p_norm = stats.shapiro(pd.concat([group1, group2]))

if p_norm > 0.05:
    # Use t-test (parametric)
    stat, p_val = stats.ttest_ind(group1, group2)
    print(f"T-test: t={stat:.3f}, p={p_val:.3f}")
else:
    # Use Mann-Whitney (non-parametric)
    stat, p_val = stats.mannwhitneyu(group1, group2)
    print(f"Mann-Whitney: U={stat:.3f}, p={p_val:.3f}")

# For multiple features
p_values = []
for col in df.columns:
    g1, g2 = df.iloc[:5, df.columns.get_loc(col)], df.iloc[5:10, df.columns.get_loc(col)]
    _, p = stats.ttest_ind(g1, g2)
    p_values.append(p)

# Multiple testing correction
rejected, p_adjusted, _, _ = multipletests(p_values, method='fdr_bh')
print(f"Significant features: {sum(rejected)}/{len(rejected)}")
```

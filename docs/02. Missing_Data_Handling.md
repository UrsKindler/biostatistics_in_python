# 2. Missing Data Handling

### Overview
- **Purpose**: Handle missing values through deletion, imputation, or indicator methods
- **Use Case**: Datasets with incomplete observations, longitudinal studies, survey data
- **Prerequisites**: Understanding of missing data mechanism (MCAR, MAR, MNAR)
- **Data Types**: Numeric (continuous/discrete), Categorical, Ordinal

### When to Use
#### Decision Criteria
- **Use Complete Case Analysis when**: Missing completely at random (MCAR), <5% missing data
- **Use Simple Imputation when**: Missing at random (MAR), moderate missingness
- **Use Multiple Imputation when**: MAR with substantial missingness (>10%)
- **Use Advanced Methods when**: Missing not at random (MNAR)

#### Data Type Requirements
- **Numeric Data**: Integer, Float (any scale)
- **Categorical Data**: String, Object, Category dtype
- **Ordinal Data**: Ordered categories, ranked data
- **Time Series**: DateTime with temporal gaps
- **Not Suitable For**: Completely text-based data, images, complex nested structures


### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `mice`, `VIM`, `Hmisc` | `sklearn.impute`, `pandas` |
| Multiple Imputation | `mice(data, m=5)` | `IterativeImputer()` |
| Simple Imputation | `Hmisc::impute(x, median)` | `SimpleImputer(strategy='median')` |
| Missing Patterns | `mice::md.pattern(data)` | `missingno.heatmap(df)` |
| KNN Imputation | `VIM::kNN(data)` | `KNNImputer(n_neighbors=5)` |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(mice)
library(Hmisc)

# Multiple imputation
imputed_data <- mice(data, m=5, method='pmm', printFlag=FALSE)
completed_data <- complete(imputed_data)

# Simple median imputation
data$variable <- impute(data$variable, median)
```

**Python Example:**
```python
from sklearn.impute import SimpleImputer, KNNImputer

# Simple imputation
imputer = SimpleImputer(strategy='median')  # or 'mean', 'most_frequent'
df_imputed = pd.DataFrame(imputer.fit_transform(df), 
                         columns=df.columns, index=df.index)

# KNN imputation for better results
knn_imputer = KNNImputer(n_neighbors=5)
df_knn = pd.DataFrame(knn_imputer.fit_transform(df), 
                      columns=df.columns, index=df.index)

# Simple forward fill for time series
df_filled = df.fillna(method='ffill')
```

**Visualization:**
```python
from sklearn.impute import KNNImputer

# Before imputation
fig, axes = plt.subplots(2, 2, figsize=(12, 10))

# Original data with missing
axes[0, 0].imshow(df.iloc[:30, :15].isnull(), cmap='RdYlGn_r', aspect='auto')
axes[0, 0].set_title('Before Imputation (Missing = Red)', fontweight='bold')
axes[0, 0].set_xlabel('Features')
axes[0, 0].set_ylabel('Samples')

# After KNN imputation
imputer = KNNImputer(n_neighbors=5)
df_imputed = pd.DataFrame(imputer.fit_transform(df), 
                         columns=df.columns, index=df.index)

axes[0, 1].imshow(df_imputed.iloc[:30, :15].isnull(), cmap='RdYlGn_r', aspect='auto')
axes[0, 1].set_title('After KNN Imputation (Complete)', fontweight='bold')
axes[0, 1].set_xlabel('Features')

# Distribution comparison
axes[1, 0].hist(df.iloc[:, 0].dropna(), bins=15, alpha=0.7, label='Original', edgecolor='black')
axes[1, 0].hist(df_imputed.iloc[:, 0], bins=15, alpha=0.7, label='Imputed', edgecolor='black')
axes[1, 0].set_title('Distribution: Protein_1', fontweight='bold')
axes[1, 0].set_xlabel('Abundance')
axes[1, 0].set_ylabel('Frequency')
axes[1, 0].legend()

# Correlation preservation
original_corr = df.corr().values[np.triu_indices_from(df.corr(), k=1)]
imputed_corr = df_imputed.corr().values[np.triu_indices_from(df_imputed.corr(), k=1)]
axes[1, 1].scatter(original_corr, imputed_corr, alpha=0.5)
axes[1, 1].plot([original_corr.min(), original_corr.max()], 
               [original_corr.min(), original_corr.max()], 
               'r--', label='Perfect preservation')
axes[1, 1].set_title('Correlation Structure Preservation', fontweight='bold')
axes[1, 1].set_xlabel('Original Correlations')
axes[1, 1].set_ylabel('Imputed Correlations')
axes[1, 1].legend()

plt.tight_layout()
plt.savefig('missing_data_handling.png', dpi=300, bbox_inches='tight')
plt.show()
```

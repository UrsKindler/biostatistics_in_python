# Variance Homogeneity Tests

### Overview
- **Purpose**: Test if variances are equal across groups (homoscedasticity assumption)
- **Use Case**: Pre-test for ANOVA, determine T-test variant, validate statistical assumptions
- **Prerequisites**: Independent groups with continuous data
- **Data Types**: Continuous numeric data grouped by categorical factor

### When to Use
#### Decision Criteria
- **Use always**: Before conducting ANOVA or pooled T-test
- **Essential when**: Comparing 3+ groups with parametric tests
- **Critical for**: Determining which post-hoc test to use after ANOVA
- **Don't skip when**: Group sample sizes are unequal

#### Data Type Requirements
- **Numeric Data**: Continuous or discrete numeric values
- **Grouping Variable**: Categorical factor with 2+ levels
- **Sample Size**: Minimum 3 observations per group
- **Not Suitable For**: Single group, paired data, categorical outcomes

### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `car`, `stats` | `scipy.stats`, `statsmodels` |
| Levene's Test | `car::leveneTest()` | `scipy.stats.levene()` |
| Bartlett's Test | `bartlett.test()` | `scipy.stats.bartlett()` |
| Fligner-Killeen | `fligner.test()` | `scipy.stats.fligner()` |
| Brown-Forsythe | `car::leveneTest(center=median)` | `scipy.stats.levene(center='median')` |

### Quick Start Code

**R Example:**

```r
Load required library
library(car)

Levene's Test (most robust)
leveneTest(response ~ group, data = data)

Bartlett's Test (for normal data)
bartlett.test(response ~ group, data = data)

Fligner-Killeen Test (non-parametric)
fligner.test(response ~ group, data = data)

Brown-Forsythe (Levene with median)
leveneTest(response ~ group, data = data, center = median)
```
**Python Example:**

```python
from scipy import stats

Separate groups
groups = [df[df['group'] == g]['response'].values
for g in df['group'].unique()]

Levene's Test (default: mean)
stat_levene, p_levene = stats.levene(*groups, center='mean')
print(f"Levene: statistic={stat_levene:.3f}, p={p_levene:.4f}")

Bartlett's Test (assumes normality)
stat_bartlett, p_bartlett = stats.bartlett(*groups)
print(f"Bartlett: statistic={stat_bartlett:.3f}, p={p_bartlett:.4f}")

Fligner-Killeen (non-parametric)
stat_fligner, p_fligner = stats.fligner(*groups, center='median')
print(f"Fligner: statistic={stat_fligner:.3f}, p={p_fligner:.4f}")

Decision
if p_levene > 0.05:
print("✓ Equal variances: Use standard ANOVA")
else:
print("✗ Unequal variances: Use Welch's ANOVA")
```

**Visualization:**
```python
from scipy import stats

# Simulate 3 groups with different variances
np.random.seed(42)
group1 = np.random.normal(100, 10, 30)  # Low variance
group2 = np.random.normal(105, 20, 30)  # High variance
group3 = np.random.normal(102, 15, 30)  # Medium variance

groups_data = [group1, group2, group3]
group_names = ['Control', 'Condition A', 'Condition B']

fig, axes = plt.subplots(1, 3, figsize=(15, 5))

# Boxplot comparison
bp = axes[0].boxplot(groups_data, labels=group_names, patch_artist=True)
for patch, color in zip(bp['boxes'], ['lightblue', 'lightcoral', 'lightgreen']):
    patch.set_facecolor(color)
axes[0].set_title('Variance Comparison (Boxplots)', fontweight='bold')
axes[0].set_ylabel('Protein Abundance')
axes[0].grid(axis='y', alpha=0.3)

# Violin plot
parts = axes[1].violinplot(groups_data, positions=[1, 2, 3], showmeans=True)
axes[1].set_xticks([1, 2, 3])
axes[1].set_xticklabels(group_names)
axes[1].set_title('Distribution Shape Comparison', fontweight='bold')
axes[1].set_ylabel('Protein Abundance')
axes[1].grid(axis='y', alpha=0.3)

# Levene test results
stat_levene, p_levene = stats.levene(*groups_data)
variances = [np.var(g, ddof=1) for g in groups_data]

axes[2].bar(group_names, variances, color=['lightblue', 'lightcoral', 'lightgreen'], 
           edgecolor='black')
axes[2].set_title(f"Levene Test: p={p_levene:.4f}", fontweight='bold')
axes[2].set_ylabel('Variance')
axes[2].axhline(y=np.mean(variances), color='red', linestyle='--', 
               label=f'Mean Variance')
if p_levene > 0.05:
    axes[2].text(0.5, 0.95, 'Equal variances', transform=axes[2].transAxes,
                ha='center', va='top', fontsize=12, color='green', fontweight='bold')
else:
    axes[2].text(0.5, 0.95, 'Unequal variances', transform=axes[2].transAxes,
                ha='center', va='top', fontsize=12, color='red', fontweight='bold')
axes[2].legend()

plt.tight_layout()
plt.savefig('03_variance_homogeneity_visualization.png', dpi=300, bbox_inches='tight')
plt.show()
```

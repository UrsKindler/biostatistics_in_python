## **9. ANOSIM & PERMANOVA**

### Overview
- **Purpose**: Test for significant differences between groups in multivariate space
- **Use Case**: Community composition analysis, multivariate group comparisons
- **Prerequisites**: Distance/dissimilarity matrix, predefined groups
- **Data Types**: **Multivariate numeric** (species abundances, feature vectors)

### When to Use
#### Decision Criteria
- **Use ANOSIM when**: Testing if groups are more different than expected by chance
- **Use PERMANOVA when**: Testing for differences in group centroids (multivariate ANOVA)
- **Required**: Multivariate data with meaningful distance measures
- **Choose distance**: Bray-Curtis for ecological, Euclidean for continuous data

### Data Type Requirements
- **Multivariate Data**: Multiple numeric variables simultaneously
- **Abundance Data**: Count/abundance matrices (samples × species/features)
- **Distance Matrices**: Computed from numeric data
- **Grouping Variable**: Categorical group assignments
- **Non-negative Data**: Typically abundance/count data ≥ 0
- **Not Suitable For**: Univariate data, purely categorical data matrices

### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `vegan` | `scikit-bio` |
| ANOSIM Function | `anosim(dist, groups)` | `anosim(distance_matrix, grouping)` |
| PERMANOVA Function | `adonis(data ~ groups)` | `permanova(distance_matrix, grouping)` |
| Distance Calculation | `vegdist(data, method="bray")` | `pdist(data, metric='braycurtis')` |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(vegan)

# ANOSIM test
anosim_result <- anosim(t(subgroupMatrix), classifications, 
                       permutations = 999, distance = "bray")

# PERMANOVA test
permanova_result <- adonis(t(subgroupMatrix) ~ CLASSIFICATIONS, 
                          data = as.data.frame(t(classifications)), 
                          permutations = 999)
```

**Python Example:**
```python
from skbio.stats.distance import anosim, permanova
from skbio import DistanceMatrix
from scipy.spatial.distance import pdist, squareform

# Create distance matrix (Bray-Curtis)
distances = pdist(df, metric='braycurtis')
distance_matrix = DistanceMatrix(squareform(distances), ids=df.index)

# Define groups (example: first 10 vs last 10 samples)
groups = ['Group1']*10 + ['Group2']*10  # Adjust to your data

# ANOSIM test
anosim_result = anosim(distance_matrix, groups, permutations=999)
print(f"ANOSIM R={anosim_result['test statistic']:.3f}, p={anosim_result['p-value']:.3f}")

# PERMANOVA test
permanova_result = permanova(distance_matrix, groups, permutations=999)
print(f"PERMANOVA F={permanova_result['test statistic']:.3f}, p={permanova_result['p-value']:.3f}")

# Quick interpretation
r_stat = anosim_result['test statistic']
if r_stat > 0.75:
    print("Well separated groups")
elif r_stat > 0.5:
    print("Overlapping but different groups")
else:
    print("Groups not well separated")
```

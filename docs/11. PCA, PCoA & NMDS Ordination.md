## **11. PCA, PCoA & NMDS Ordination**

### Overview
- **Purpose**: Reduce dimensionality and visualize patterns in multivariate data
- **Use Case**: Data exploration, dimension reduction, visualization
- **Prerequisites**: Numeric data, consideration of scaling needs

### When to Use
#### Decision Criteria
- **Use PCA when**: Linear relationships, want to explain variance
- **Use PCoA when**: Using ecological distances (Bray-Curtis), preserve distances
- **Use NMDS when**: Non-linear relationships, focus on rank orders
- **Always**: Check stress values (NMDS) and explained variance (PCA)
- **Data Types**: **PCA: Continuous numeric**, **PCoA: Distance matrix**, **NMDS: Ordinal + Continuous**

### Data Type Requirements

#### PCA:
- **Continuous Data**: Float, Double (all variables)
- **Linear Relationships**: Assumes linear combinations
- **Scaled Data**: Variables should be standardized
- **Complete Cases**: No missing values

#### PCoA:
- **Distance Matrix**: Any data that can generate meaningful distances
- **Abundance Data**: Species/feature abundance matrices
- **Ecological Data**: Community composition data

#### NMDS:
- **Ordinal Data**: Rank-order preserved
- **Distance Matrix**: Non-metric distances
- **Ecological Data**: Community/abundance data
- **Robust to**: Non-linear relationships, non-normal distributions

**Not Suitable For**: Purely categorical nominal data (without distance measures)

### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `vegan`, `factoextra` | `sklearn.decomposition`, `sklearn.manifold` |
| PCA | `prcomp(data, scale=TRUE)` | `PCA()` |
| PCoA | `cmdscale(vegdist(data))` | `MDS()` or `scikit-bio.pcoa()` |
| NMDS | `metaMDS(data)` | `MDS(metric=False)` |
| Visualization | `fviz_pca_biplot()` | `matplotlib` plots |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(vegan)
library(factoextra)

# PCA analysis
PCA <- prcomp(matrix, scale = TRUE)
screeplot(PCA)

fviz_pca_ind(PCA, geom.ind = "text", addEllipses = FALSE)
fviz_pca_biplot(PCA, geom.ind = "text", addEllipses = FALSE)

# PCoA
distance_matrix <- vegdist(data, method = "bray")
pcoa_result <- cmdscale(distance_matrix)

# NMDS
nmds_result <- metaMDS(data, distance = "bray", k = 2)
```

**Python Example:**
```python
from sklearn.decomposition import PCA
from sklearn.manifold import MDS
from sklearn.preprocessing import StandardScaler
from scipy.spatial.distance import pdist, squareform
import matplotlib.pyplot as plt

# PCA
scaler = StandardScaler()
df_scaled = scaler.fit_transform(df)

pca = PCA()
pca_coords = pca.fit_transform(df_scaled)

# Explained variance
print(f"PC1 explains {pca.explained_variance_ratio_[0]:.1%} of variance")
print(f"PC2 explains {pca.explained_variance_ratio_[1]:.1%} of variance")
print(f"First 2 PCs explain {sum(pca.explained_variance_ratio_[:2]):.1%} total")

# Plot PCA
plt.figure(figsize=(8, 6))
plt.scatter(pca_coords[:, 0], pca_coords[:, 1])
plt.xlabel(f'PC1 ({pca.explained_variance_ratio_[0]:.1%})')
plt.ylabel(f'PC2 ({pca.explained_variance_ratio_[1]:.1%})')
plt.title('PCA Analysis')

# PCoA (using Bray-Curtis distance)
distances = pdist(df, metric='braycurtis')
mds = MDS(n_components=2, dissimilarity='precomputed', random_state=42)
pcoa_coords = mds.fit_transform(squareform(distances))

# NMDS (non-metric MDS)
nmds = MDS(n_components=2, metric=False, random_state=42)
nmds_coords = nmds.fit_transform(df_scaled)
print(f"NMDS stress: {nmds.stress_:.3f}")

# Plot ordinations
fig, axes = plt.subplots(1, 3, figsize=(15, 5))
axes[0].scatter(pca_coords[:, 0], pca_coords[:, 1])
axes[0].set_title('PCA')
axes[1].scatter(pcoa_coords[:, 0], pcoa_coords[:, 1])
axes[1].set_title('PCoA')
axes[2].scatter(nmds_coords[:, 0], nmds_coords[:, 1])
axes[2].set_title('NMDS')
plt.tight_layout()
```

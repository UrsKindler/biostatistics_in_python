## **6. Pearson & Spearman Correlation**

### Overview
- **Purpose**: Measure linear (Pearson) or monotonic (Spearman) relationships between variables
- **Use Case**: Feature selection, exploratory analysis, variable relationships
- **Prerequisites**: Continuous (Pearson) or ordinal (Spearman) data
- **Data Types**: **Pearson: Continuous numeric**, **Spearman: Ordinal + Continuous**

### When to Use
#### Decision Criteria
- **Use Pearson when**: Both variables normally distributed, linear relationship
- **Use Spearman when**: Non-normal data, monotonic relationship, ordinal data
- **Use Kendall when**: Small samples, many tied values
- **Always apply**: Multiple testing correction for many comparisons

### Data Type Requirements

#### Pearson Correlation:
- **Continuous Data**: Float, Double (required)
- **Normal Distribution**: Preferably normally distributed
- **Linear Relationship**: Assumes linear associations
- **Interval/Ratio Scale**: Equal intervals required

#### Spearman Correlation:
- **Ordinal Data**: Ranked, ordered categories
- **Continuous Data**: Any continuous numeric
- **Non-normal Data**: Distribution-free
- **Monotonic Relationship**: Rank-based correlation

**Not Suitable For**: Nominal categorical data, binary data (use Cram√©r's V instead)

### R vs Python 

| Aspect | R | Python |
|--------|---|--------|
| Package | `base R` | `scipy.stats`, `pandas` |
| Pearson | `cor(x, y, method="pearson")` | `pearsonr(x, y)` or `df.corr()` |
| Spearman | `cor(x, y, method="spearman")` | `spearmanr(x, y)` |
| Correlation Matrix | `cor(data)` | `df.corr()` |
| Significance Test | `cor.test(x, y)` | `pearsonr()` returns p-value |

### Quick Start Code

**R Example:**
```r
# Correlation matrix (base R)
cor_pearson <- cor(data, method = "pearson", use = "complete.obs")
cor_spearman <- cor(data, method = "spearman", use = "complete.obs")
cor_kendall <- cor(data, method = "kendall", use = "complete.obs")

# Test single correlation
cor.test(data$var1, data$var2, method = "pearson")
```

**Python Example:**
```python
import pandas as pd
from scipy import stats

# Correlation matrices
corr_pearson = df.corr(method='pearson')
corr_spearman = df.corr(method='spearman')
corr_kendall = df.corr(method='kendall')

# Single correlation with significance
r, p = stats.pearsonr(df.iloc[:, 0].dropna(), df.iloc[:, 1].dropna())
print(f"Pearson r={r:.3f}, p={p:.3f}")

# Spearman correlation
rho, p = stats.spearmanr(df.iloc[:, 0].dropna(), df.iloc[:, 1].dropna())
print(f"Spearman rho={rho:.3f}, p={p:.3f}")

# Automatic method selection based on normality
def smart_correlation(x, y):
    # Remove NaN values
    clean_data = pd.DataFrame({'x': x, 'y': y}).dropna()
    if len(clean_data) < 3:
        return (float('nan'), float('nan')), 'insufficient_data'
    
    x_clean, y_clean = clean_data['x'], clean_data['y']
    
    if len(x_clean) <= 5000:
        _, p_norm_x = stats.shapiro(x_clean)
        _, p_norm_y = stats.shapiro(y_clean)
        
        if p_norm_x > 0.05 and p_norm_y > 0.05:
            return stats.pearsonr(x_clean, y_clean), 'pearson'
        else:
            return stats.spearmanr(x_clean, y_clean), 'spearman'
    else:
        return stats.spearmanr(x_clean, y_clean), 'spearman'

# Apply smart correlation
(r, p), method = smart_correlation(df.iloc[:, 0], df.iloc[:, 1])
print(f"{method.title()} correlation: r={r:.3f}, p={p:.3f}")
```

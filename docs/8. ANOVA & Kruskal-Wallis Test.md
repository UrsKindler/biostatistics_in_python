## **8. ANOVA & Kruskal-Wallis Test**

### Overview
- **Purpose**: Compare means/distributions across three or more independent groups
- **Use Case**: Multiple treatment conditions, dose-response studies
- **Prerequisites**: Independent observations, one grouping factor
- **Data Types**: **ANOVA: Continuous numeric**, **Kruskal-Wallis: Ordinal + Continuous**

### When to Use
#### Decision Criteria
- **Use ANOVA when**: Data is normally distributed and variances are equal
- **Use Kruskal-Wallis when**: Non-normal data or unequal variances
- **Required**: At least 3 groups for comparison
- **Follow with**: Post-hoc tests for pairwise comparisons

### Data Type Requirements

#### ANOVA:
- **Continuous Data**: Float, Double (dependent variable)
- **Normal Distribution**: Required assumption
- **Equal Variances**: Homoscedasticity assumption
- **Categorical Grouping**: Nominal groups (independent variable)

#### Kruskal-Wallis:
- **Ordinal Data**: Ranked dependent variable
- **Continuous Data**: Any continuous numeric (distribution-free)
- **Non-normal Data**: No distribution assumptions
- **Categorical Grouping**: Nominal groups

**Not Suitable For**: Nominal dependent variables, binary outcomes

### R vs Python

| Aspect | R | Python |
|--------|---|--------|
| Package | `base R`, `FSA` | `scipy.stats`, `statsmodels` |
| ANOVA Function | `aov(values ~ groups)` | `f_oneway(*groups)` |
| Kruskal-Wallis | `kruskal.test(values ~ groups)` | `kruskal(*groups)` |
| Post-hoc ANOVA | `TukeyHSD()` | `pairwise_tukeyhsd()` |
| Post-hoc Kruskal | `dunnTest()` | `posthoc_dunn()` |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(FSA)  # for Dunn test

# ANOVA
anova_result <- aov(as.numeric(matrix[i, 1:ncol(matrix)]) ~ groups, data = matrix)
p_value <- unlist(summary(anova_result))["Pr(>F)1"]

# Post-hoc Tukey test
tukey <- TukeyHSD(anova_result)

# Kruskal-Wallis test
kruskal_result <- kruskal.test(as.numeric(matrix[i, 1:ncol(matrix)]) ~ groups, data = matrix)

# Post-hoc Dunn test
dunn_result <- dunnTest(as.numeric(matrix[i, 1:ncol(matrix)]) ~ groups, data = matrix, method = "none")
```

**Python Example:**
```python
from scipy import stats
from statsmodels.stats.multicomp import pairwise_tukeyhsd
import scikit_posthocs as sp

# Define 3 groups (example)
group1 = df.iloc[:5, 0]   
group2 = df.iloc[5:10, 0]  
group3 = df.iloc[10:15, 0] 

# Test assumptions
combined = pd.concat([group1, group2, group3])
_, p_norm = stats.shapiro(combined)
_, p_levene = stats.levene(group1, group2, group3)

if p_norm > 0.05 and p_levene > 0.05:
    # ANOVA (parametric)
    f_stat, p_val = stats.f_oneway(group1, group2, group3)
    print(f"ANOVA: F={f_stat:.3f}, p={p_val:.3f}")
    
    # Post-hoc Tukey HSD
    data_long = pd.DataFrame({
        'values': combined,
        'groups': ['Group1']*5 + ['Group2']*5 + ['Group3']*5
    })
    tukey = pairwise_tukeyhsd(data_long['values'], data_long['groups'])
    print(tukey)
else:
    # Kruskal-Wallis (non-parametric)
    h_stat, p_val = stats.kruskal(group1, group2, group3)
    print(f"Kruskal-Wallis: H={h_stat:.3f}, p={p_val:.3f}")
    
    # Post-hoc Dunn test
    dunn_results = sp.posthoc_dunn([group1, group2, group3])
    print(dunn_results)
```

## **5. Shapiro-Wilk Normality Test**

### Overview
- **Purpose**: Test if data follows normal distribution (prerequisite for parametric tests)
- **Use Case**: Before t-tests, ANOVA, correlation analysis
- **Prerequisites**: Continuous data, sample size < 5000 (Shapiro-Wilk limitation)

### When to Use
#### Decision Criteria
- **Use Shapiro-Wilk when**: Sample size < 50 (most powerful)
- **Use Anderson-Darling when**: Sample size 50-200
- **Use Kolmogorov-Smirnov when**: Large samples (>200)
- **Always combine with**: Visual inspection (Q-Q plots)

### R Legacy vs Python Modern

| Aspect | R | Python |
|--------|---|--------|
| Package | `base R` | `scipy.stats` |
| Shapiro-Wilk | `shapiro.test(data)` | `shapiro(data)` |
| Anderson-Darling | `nortest::ad.test(data)` | `anderson(data)` |
| Kolmogorov-Smirnov | `ks.test(data, "pnorm")` | `kstest(data, 'norm')` |
| Q-Q Plot | `qqnorm(data); qqline(data)` | `stats.probplot(data, plot=plt)` |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(nortest)  # for Anderson-Darling test

# Test normality for each row/feature
shapiro_results <- apply(data, 1, function(x) {
  test <- shapiro.test(x)
  c(statistic = test$statistic, p.value = test$p.value)
})

# Check normality for specific variable
shapiro.test(data$variable)

# Anderson-Darling test for larger samples
ad.test(data$variable)
```

**Python Simple:**
```python
from scipy import stats

# Test single variable
statistic, p_value = stats.shapiro(df.iloc[:, 0])
print(f"Shapiro-Wilk: statistic={statistic:.4f}, p-value={p_value:.4f}")

# Test all features
normality_results = {}
for col in df.columns:
    if len(df[col].dropna()) <= 5000:  # Shapiro limit
        stat, p = stats.shapiro(df[col].dropna())
        normality_results[col] = {'statistic': stat, 'p_value': p, 'is_normal': p > 0.05}

# Convert to DataFrame for easy viewing
norm_df = pd.DataFrame(normality_results).T
print(f"Normal features: {norm_df['is_normal'].sum()}/{len(norm_df)}")
```

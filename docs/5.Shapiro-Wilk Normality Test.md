## **5. Shapiro-Wilk Normality Test**

### Overview
- **Purpose**: Test if data follows normal distribution (prerequisite for parametric tests)
- **Use Case**: Before t-tests, ANOVA, correlation analysis
- **Prerequisites**: Continuous data, sample size < 5000 (Shapiro-Wilk limitation)
- **Data Types**: **Continuous numeric only**

### When to Use
#### Decision Criteria
- **Use Shapiro-Wilk when**: Sample size < 50 (most powerful)
- **Use Anderson-Darling when**: Sample size 50-200
- **Use Kolmogorov-Smirnov when**: Large samples (>200)
- **Always combine with**: Visual inspection (Q-Q plots)

### Data Type Requirements
- **Continuous Data**: Float, Double (required)
- **Sample Size**: 3 ≤ n ≤ 5000 for Shapiro-Wilk
- **No Missing Values**: Complete cases only
- **Single Variable**: Univariate test only
- **Not Suitable For**: Categorical data, ordinal data, discrete counts, binary data

### R vs Python 

| Aspect | R | Python |
|--------|---|--------|
| Package | `base R`, `nortest` | `scipy.stats`, `pandas`, `matplotlib` |
| Shapiro-Wilk | `shapiro.test(data)` | `stats.shapiro(data)` |
| Anderson-Darling | `nortest::ad.test(data)` | `stats.anderson(data)` |
| Kolmogorov-Smirnov | `ks.test(data, "pnorm")` | `stats.kstest(data, 'norm')` |
| Q-Q Plot | `qqnorm(data); qqline(data)` | `stats.probplot(data, plot=plt)` |

### Quick Start Code

**R Example:**
```r
# Load required libraries
library(nortest)  # for Anderson-Darling test

# Test normality for each row/feature
shapiro_results <- apply(data, 1, function(x) {
  test <- shapiro.test(x)
  c(statistic = test$statistic, p.value = test$p.value)
})

# Check normality for specific variable
shapiro.test(data$variable)

# Anderson-Darling test for larger samples
ad.test(data$variable)
```

**Python Example:**
```python
import pandas as pd
from scipy import stats
import matplotlib.pyplot as plt

# Test single variable
if len(df.iloc[:, 0].dropna()) <= 5000:
    statistic, p_value = stats.shapiro(df.iloc[:, 0].dropna())
    print(f"Shapiro-Wilk: statistic={statistic:.4f}, p-value={p_value:.4f}")

# Test all features
normality_results = {}
for col in df.columns:
    clean_data = df[col].dropna()
    if len(clean_data) >= 3 and len(clean_data) <= 5000:  # Shapiro limits
        stat, p = stats.shapiro(clean_data)
        normality_results[col] = {'statistic': stat, 'p_value': p, 'is_normal': p > 0.05}

# Convert to DataFrame for easy viewing
norm_df = pd.DataFrame(normality_results).T
print(f"Normal features: {norm_df['is_normal'].sum()}/{len(norm_df)}")

# Q-Q plot
stats.probplot(df.iloc[:, 0].dropna(), dist="norm", plot=plt)
plt.show()
```
